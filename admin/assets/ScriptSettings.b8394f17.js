import{v as D,a as $,E as H,C as T,h as G,_ as L}from"./index.080c3c87.js";/* empty css              *//* empty css               *//* empty css              *//* empty css                *//* empty css                *//* empty css                */import{d as q,j as U,aY as J,b6 as K,aX as M,O,aV as X,bT as Y,bH as P,bN as Q,b9 as W,ba as Z,aE as p,aH as l,C as r,aI as o,aK as d,aL as u,D as ee,aJ as ae,F as se,E as b,G as le,aF as i,u as k,aM as oe,b7 as te,bU as ne}from"./arco.fe08071c.js";import"./chart.a7740a30.js";import"./vue.ce9ec506.js";const re={style:{display:"flex","justify-content":"center","align-items":"center","column-gap":"10px","margin-left":"16px"}},ce=["onClick"],pe=q({__name:"ScriptSettings",setup(de){const{t:V}=D.exports.useI18n(),g=U(!1),c=U([]),C=()=>({enabled:!0,scriptName:"",type:"external",src:"",code:"",async:!1,defer:!1,crossorigin:"",collapsed:!1}),I=a=>Array.isArray(a)?a.map(e=>({enabled:!!(e!=null&&e.enabled),scriptName:(e==null?void 0:e.scriptName)||(e==null?void 0:e.remark)||"",type:(e==null?void 0:e.type)==="inline"?"inline":"external",src:(e==null?void 0:e.src)||"",code:(e==null?void 0:e.code)||"",async:!!(e!=null&&e.async),defer:!!(e!=null&&e.defer),crossorigin:(e==null?void 0:e.crossorigin)||"",collapsed:!1})):[],h=async()=>{const a=await $.get("/api/admin/sys-config/configs");c.value=I(a.scriptInjections)};h();const S=()=>{c.value.push(C())},w=a=>{c.value.splice(a,1)},E=a=>{const e=c.value[a];!e||(e.collapsed=!e.collapsed)},j=async()=>{if(c.value.some(e=>!e.scriptName||!e.scriptName.trim())){H(V("pages.settings.script.message.scriptNameRequired"));return}g.value=!0;try{await $.post("/api/admin/sys-config/save",{scriptInjections:c.value.map(e=>({enabled:e.enabled,scriptName:e.scriptName.trim(),type:e.type,src:e.src,code:e.code,async:e.async,defer:e.defer,crossorigin:e.crossorigin}))}),await h(),T(V("pages.settings.script.message.submitSuccess"))}catch(e){G(e)}finally{g.value=!1}};return(a,e)=>{const x=J,_=K,f=M,z=O,y=X,n=te,v=Y,B=ne,F=P,R=Q,N=W,A=Z;return r(),p(A,{"auto-label-width":""},{default:l(()=>[o(N,{direction:"vertical",fill:"",size:16},{default:l(()=>[o(x,{type:"warning"},{default:l(()=>[d(u(a.$t("pages.settings.script.tip")),1)]),_:1}),(r(!0),ee(oe,null,ae(k(c),(s,m)=>(r(),p(R,{key:m,class:se({"script-card-collapsed":s.collapsed}),"body-style":s.collapsed?{display:"none",padding:"0"}:void 0},{title:l(()=>[o(_,{modelValue:s.scriptName,"onUpdate:modelValue":t=>s.scriptName=t,placeholder:a.$t("pages.settings.script.placeholder.scriptName")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),extra:l(()=>[b("div",re,[o(f,{status:"danger",onClick:t=>w(m)},{default:l(()=>[d(u(a.$t("pages.settings.script.remove")),1)]),_:2},1032,["onClick"]),b("div",{style:{cursor:"pointer",height:"32px",width:"32px",display:"flex","justify-content":"center","align-items":"center"},onClick:t=>E(m)},[o(z,{style:le({transform:s.collapsed?"rotate(-90deg)":"rotate(0deg)",transition:"transform 0.2s"})},null,8,["style"])],8,ce)])]),default:l(()=>[b("div",null,[o(n,{label:a.$t("pages.settings.script.enabled")},{default:l(()=>[o(y,{modelValue:s.enabled,"onUpdate:modelValue":t=>s.enabled=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),o(n,{label:a.$t("pages.settings.script.type")},{default:l(()=>[o(B,{modelValue:s.type,"onUpdate:modelValue":t=>s.type=t},{default:l(()=>[o(v,{value:"external"},{default:l(()=>[d(u(a.$t("pages.settings.script.external")),1)]),_:1}),o(v,{value:"inline"},{default:l(()=>[d(u(a.$t("pages.settings.script.inline")),1)]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),s.type==="external"?(r(),p(n,{key:0,label:a.$t("pages.settings.script.src")},{default:l(()=>[o(_,{modelValue:s.src,"onUpdate:modelValue":t=>s.src=t,placeholder:a.$t("pages.settings.script.placeholder.src")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])):i("",!0),s.type==="external"?(r(),p(n,{key:1,label:a.$t("pages.settings.script.async")},{default:l(()=>[o(y,{modelValue:s.async,"onUpdate:modelValue":t=>s.async=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):i("",!0),s.type==="external"?(r(),p(n,{key:2,label:a.$t("pages.settings.script.defer")},{default:l(()=>[o(y,{modelValue:s.defer,"onUpdate:modelValue":t=>s.defer=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):i("",!0),s.type==="external"?(r(),p(n,{key:3,label:a.$t("pages.settings.script.crossorigin")},{default:l(()=>[o(_,{modelValue:s.crossorigin,"onUpdate:modelValue":t=>s.crossorigin=t,placeholder:a.$t("pages.settings.script.placeholder.crossorigin")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])):i("",!0),s.type==="inline"?(r(),p(n,{key:4,label:a.$t("pages.settings.script.code")},{default:l(()=>[o(F,{modelValue:s.code,"onUpdate:modelValue":t=>s.code=t,"auto-size":{minRows:6,maxRows:16},placeholder:a.$t("pages.settings.script.placeholder.code")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])):i("",!0)])]),_:2},1032,["class","body-style"]))),128)),o(N,null,{default:l(()=>[o(f,{type:"outline",onClick:S},{default:l(()=>[d(u(a.$t("pages.settings.script.add")),1)]),_:1})]),_:1}),o(n,null,{default:l(()=>[o(f,{type:"primary",loading:k(g),onClick:j},{default:l(()=>[d(u(a.$t("pages.settings.script.submit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})}}});const ve=L(pe,[["__scopeId","data-v-f87ddc8c"]]);export{ve as default};
