import{v as se,a as R,E as oe,C as ie,h as re,G as k,_ as ce}from"./index.080c3c87.js";/* empty css              *//* empty css                *//* empty css                *//* empty css              *//* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css              *//* empty css               *//* empty css               *//* empty css               */import{d as de,j as b,c as ue,a6 as pe,aX as ve,au as _e,af as me,bD as ge,b6 as he,aV as fe,bP as we,ba as be,b9 as ye,bL as Ie,D as y,aI as a,aH as l,E as u,u as t,bQ as Ce,C as m,aL as g,aM as $,aJ as Ne,F as Ve,bp as U,aE as F,aK as De,bR as ke,b7 as Ue,bS as ze,bM as Se}from"./arco.fe08071c.js";import"./chart.a7740a30.js";import"./vue.ce9ec506.js";const Te={class:"nav-editor"},Ee={class:"pane"},Pe={class:"pane-title-row"},We={class:"pane-title"},Be={key:0,class:"primary-list"},Re=["onClick","onDragstart","onDragenter","onDrop"],$e={class:"item-main"},Fe={class:"item-row"},Le={class:"drag-indicator"},Me={class:"item-title"},qe={class:"item-url-inline"},Ge={class:"item-actions"},Oe={class:"pane"},je={class:"pane-title"},Ae={class:"child-toolbar"},He={class:"pane-title"},Je={class:"submit-bar"},Ke=de({__name:"NavSettings",setup(Qe){const{t:s}=se.exports.useI18n(),N=b(!1),r=b([]),o=b(-1),_=b(-1),I=b(-1),d=ue(()=>r.value[o.value]),L=()=>({title:"",url:"",openInNewWindow:!1,children:[]}),M=()=>({title:"",url:"",openInNewWindow:!1}),q=(e=[])=>e.map(n=>({title:n.title||"",url:n.url||"",openInNewWindow:!!n.openInNewWindow,children:(n.children||[]).map(v=>({title:v.title||"",url:v.url||"",openInNewWindow:!!v.openInNewWindow}))})),z=()=>{if(!r.value.length){o.value=-1;return}(o.value<0||o.value>=r.value.length)&&(o.value=0)},S=async()=>{const e=await R.get("/api/admin/sys-config/configs");r.value=q(e.siteNavs),z()};S();const G=e=>{o.value=e},O=()=>{r.value.push(L()),o.value=r.value.length-1},j=e=>{r.value.splice(e,1),o.value>e?o.value-=1:o.value===e&&(o.value=e-1),z()},A=(e,n)=>{if(e<0||n<0||e>=r.value.length||n>=r.value.length||e===n)return;const[v]=r.value.splice(e,1);r.value.splice(n,0,v),o.value===e?o.value=n:o.value>e&&o.value<=n?o.value-=1:o.value<e&&o.value>=n&&(o.value+=1)},H=(e,n)=>{_.value=e,I.value=e,n.dataTransfer&&(n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/plain",String(e)))},J=e=>{_.value<0||e<0||(A(_.value,e),T())},K=e=>{_.value<0||(I.value=e)},T=()=>{_.value=-1,I.value=-1},Q=()=>{!d.value||(d.value.children||(d.value.children=[]),d.value.children.push(M()))},X=e=>{var n;!((n=d.value)!=null&&n.children)||d.value.children.splice(e,1)},Y=e=>{!d.value||(d.value.children=e)},Z=()=>r.value.some(p=>k(p.title))?s("pages.settings.nav.message.validationTitleRequired"):r.value.some(p=>!(p.children||[]).length&&k(p.url))?s("pages.settings.nav.message.validationPrimaryUrlRequired"):r.value.some(p=>(p.children||[]).some(h=>k(h.title,h.url)))?s("pages.settings.nav.message.validationChildRequired"):"",x=async()=>{N.value=!0;try{const e=Z();if(e){oe(e);return}await R.post("/api/admin/sys-config/save",{siteNavs:r.value}),await S(),ie(s("pages.settings.nav.message.submitSuccess"))}catch(e){re(e)}finally{N.value=!1}};return(e,n)=>{const v=pe,p=ve,h=_e,E=me,P=ge,W=ke,C=he,V=Ue,D=ze,B=fe,ee=we,ae=be,f=Se,te=ye,ne=Ie,le=Ce;return m(),y("div",Te,[a(le,{gutter:12},{default:l(()=>[a(W,{span:9},{default:l(()=>[u("div",Ee,[u("div",Pe,[u("div",We,g(t(s)("pages.settings.nav.primaryList")),1),a(p,{size:"small",type:"primary",shape:"circle",onClick:O},{default:l(()=>[a(v)]),_:1})]),t(r).length?(m(),y("div",Be,[(m(!0),y($,null,Ne(t(r),(i,c)=>(m(),y("div",{key:c,class:Ve(["primary-item",{active:t(o)===c,dragging:t(_)===c,"drag-over":t(I)===c&&t(_)!==c}]),draggable:"true",onClick:w=>G(c),onDragstart:w=>H(c,w),onDragend:T,onDragover:n[0]||(n[0]=U(()=>{},["prevent"])),onDragenter:U(w=>K(c),["prevent"]),onDrop:w=>J(c)},[u("div",$e,[u("div",Fe,[u("span",Le,[a(h)]),u("span",Me,g(i.title||t(s)("pages.settings.nav.untitled")),1),u("span",qe,g(i.url||t(s)("pages.settings.nav.groupMenu")),1)])]),u("div",Ge,[a(p,{size:"mini",status:"danger",shape:"circle",onClick:U(w=>j(c),["stop"])},{default:l(()=>[a(E)]),_:2},1032,["onClick"])])],42,Re))),128))])):(m(),F(P,{key:1,description:t(s)("pages.settings.nav.empty")},null,8,["description"]))])]),_:1}),a(W,{span:15},{default:l(()=>[u("div",Oe,[t(d)?(m(),y($,{key:0},[u("div",je,g(t(s)("pages.settings.nav.detailTitle")),1),a(ae,{layout:"vertical",size:"small"},{default:l(()=>[a(ee,{cols:24,"col-gap":12},{default:l(()=>[a(D,{span:7},{default:l(()=>[a(V,{label:t(s)("pages.settings.nav.tableTitle")},{default:l(()=>[a(C,{modelValue:t(d).title,"onUpdate:modelValue":n[1]||(n[1]=i=>t(d).title=i)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),a(D,{span:13},{default:l(()=>[a(V,{label:t(s)("pages.settings.nav.tableUrl")},{default:l(()=>[a(C,{modelValue:t(d).url,"onUpdate:modelValue":n[2]||(n[2]=i=>t(d).url=i),placeholder:t(s)("pages.settings.nav.groupUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,{span:4},{default:l(()=>[a(V,{label:t(s)("pages.settings.nav.tableOpenInNewWindow")},{default:l(()=>[a(B,{modelValue:t(d).openInNewWindow,"onUpdate:modelValue":n[3]||(n[3]=i=>t(d).openInNewWindow=i)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),u("div",Ae,[u("div",He,g(t(s)("pages.settings.nav.childrenTitle")),1),a(p,{size:"small",type:"primary",shape:"circle",onClick:Q},{default:l(()=>[a(v)]),_:1})]),a(ne,{data:t(d).children||[],pagination:!1,size:"small",draggable:{type:"handle",width:40},onChange:Y},{columns:l(()=>[a(f,{title:t(s)("pages.settings.nav.sort"),width:72},null,8,["title"]),a(f,{title:t(s)("pages.settings.nav.tableTitle"),width:220},{cell:l(({record:i})=>[a(C,{modelValue:i.title,"onUpdate:modelValue":c=>i.title=c,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),a(f,{title:t(s)("pages.settings.nav.tableUrl")},{cell:l(({record:i})=>[a(C,{modelValue:i.url,"onUpdate:modelValue":c=>i.url=c,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),a(f,{title:t(s)("pages.settings.nav.tableOpenInNewWindow"),width:140},{cell:l(({record:i})=>[a(B,{modelValue:i.openInNewWindow,"onUpdate:modelValue":c=>i.openInNewWindow=c,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),a(f,{title:t(s)("pages.settings.nav.operation"),width:90},{cell:l(({rowIndex:i})=>[a(te,{size:"mini"},{default:l(()=>[a(p,{size:"mini",status:"danger",shape:"circle",onClick:c=>X(i)},{default:l(()=>[a(E)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["title"])]),_:1},8,["data"])],64)):(m(),F(P,{key:1,description:t(s)("pages.settings.nav.noSelection")},null,8,["description"]))])]),_:1})]),_:1}),u("div",Je,[a(p,{type:"primary",loading:t(N),onClick:x},{default:l(()=>[De(g(t(s)("pages.settings.nav.submit")),1)]),_:1},8,["loading"])])])}}});const va=ce(Ke,[["__scopeId","data-v-438aed7d"]]);export{va as default};
