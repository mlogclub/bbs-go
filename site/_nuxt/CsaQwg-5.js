import{_ as B,a as H,R as $,b as N}from"./B6YaitEa.js";import{_ as S}from"./BlgFWldK.js";import{_ as D,a as P}from"./_ZR5j6Ep.js";import{_ as R}from"./BbEd4hLB.js";import{u as z}from"./DpnjZrq0.js";import{u as F,a as L,j,k as A,g as f,a3 as G,o as l,c as p,b as s,e,t as g,d,h as v,s as h,w as K,f as Q,v as q,K as V,D as J,z as O,G as W,E as X,H as Y,n as Z}from"./CJzXP6Za.js";import{u as tt}from"./D7RcfSdU.js";import{u as et}from"./Crz9ueD4.js";import"./cMlxSMQ7.js";import"./LGu3flMp.js";import"./BtndGyf2.js";import"./2CCwYrQ6.js";import"./C7lyS26n.js";import"./De4aO46H.js";import"./Cc_-16Bv.js";import"./BtcHo0qI.js";import"./BoQTQDTW.js";import"./CcFcSr0Z.js";import"./FUKBWQwh.js";import"./gFIAofDC.js";import"./jq10_1xn.js";import"./BbINoFVK.js";import"./CDN07tui.js";import"./Cj50OqVm.js";import"./wz7zWeh9.js";import"./D9mV7orz.js";import"./DzgUkL5_.js";import"./BT8yo6_0.js";import"./Cjdb7r0I.js";import"./CTyPoCC_.js";import"./DrXcdfvr.js";import"./BzJeq6bi.js";import"./C6Y-ieo6.js";import"./D1mR7rmP.js";import"./CdZrbHmy.js";import"./BfnjQU5U.js";import"./B_DlFklR.js";import"./DuQb2Aa5.js";const ot={class:"main"},st={class:"container"},it={key:0,class:"publish-form"},nt={class:"form-title"},at={class:"form-title-name"},lt={key:0,class:"editor-type"},dt={key:1,class:"editor-type"},rt={class:"field"},mt={class:"field"},pt={class:"control"},ct={class:"field"},ut={class:"control"},_t={key:0,class:"field"},ft={class:"control"},gt={class:"field"},vt={class:"control"},ht={class:"form-footer"},ie={__name:"[id]",async setup(Vt){let n,c;const{t:a}=F();L({title:tt(a("pages.topic.edit.pageTitle"))});const k=j(),C=A(),w=J(()=>C.config.enableHideContent),{data:y}=([n,c]=f(()=>V("/api/topic/nodes")),n=await n,c(),n),{data:t}=([n,c]=f(()=>V(`/api/topic/edit/${k.params.id}`)),n=await n,c(),n),r=Z(!1);let u=0;const T=()=>{et(a("pages.topic.edit.switchEditorConfirm")).then(()=>{t.value.content="",t.value.contentType==="markdown"?t.value.contentType="html":t.value.contentType="markdown"}).catch(()=>{})};async function U(){const m=Date.now();if(!(m-u<500)&&(u=m,!r.value)){r.value=!0;try{await O(`/api/topic/edit/${t.value.id}`,{nodeId:t.value.nodeId,title:t.value.title,content:t.value.content,hideContent:t.value.hideContent,tags:t.value.tags||[]}),W({message:a("pages.topic.edit.success"),onClose(){X(`/topic/${t.value.id}`)}})}catch(o){r.value=!1,Y(a("pages.topic.edit.failed",{msg:o.message||o}))}}}return(m,o)=>{const b=N,I=S,E=D,_=G("MEditor"),M=P,x=R;return l(),p("section",ot,[s("div",st,[e(t)?(l(),p("div",it,[s("div",nt,[s("div",at,g(e(a)("pages.topic.edit.title")),1),s("div",{class:"form-title-switch",onClick:T},[e(t).contentType==="markdown"?(l(),p("div",lt,[...o[6]||(o[6]=[s("img",{src:B},null,-1),s("span",null,"Markdown",-1)])])):(l(),p("div",dt,[...o[7]||(o[7]=[s("img",{src:H},null,-1),s("span",null,"HTML",-1)])])),d(e($),{class:"h-4 w-4"})])]),s("div",rt,[d(b,{modelValue:e(t).nodeId,"onUpdate:modelValue":o[0]||(o[0]=i=>e(t).nodeId=i),nodes:e(y)||[]},null,8,["modelValue","nodes"])]),s("div",mt,[s("div",pt,[d(I,{modelValue:e(t).title,"onUpdate:modelValue":o[1]||(o[1]=i=>e(t).title=i),placeholder:e(a)("pages.topic.edit.titlePlaceholder")},null,8,["modelValue","placeholder"])])]),s("div",ct,[s("div",ut,[e(t).contentType==="markdown"?(l(),v(E,{key:0,modelValue:e(t).content,"onUpdate:modelValue":o[2]||(o[2]=i=>e(t).content=i),placeholder:e(a)("pages.topic.edit.contentPlaceholder")},null,8,["modelValue","placeholder"])):(l(),v(_,{key:1,modelValue:e(t).content,"onUpdate:modelValue":o[3]||(o[3]=i=>e(t).content=i),"upload-image":"useUploadImage"in m?m.useUploadImage:e(z)},null,8,["modelValue","upload-image"]))])]),e(w)||e(t).hideContent?(l(),p("div",_t,[s("div",ft,[d(_,{modelValue:e(t).hideContent,"onUpdate:modelValue":o[4]||(o[4]=i=>e(t).hideContent=i),height:"200px"},null,8,["modelValue"])])])):h("",!0),s("div",gt,[s("div",vt,[d(M,{modelValue:e(t).tags,"onUpdate:modelValue":o[5]||(o[5]=i=>e(t).tags=i)},null,8,["modelValue"])])]),s("div",ht,[d(x,{class:q({"is-loading":e(r)}),disabled:e(r),onClick:U},{default:K(()=>[Q(g(e(a)("pages.topic.edit.submitBtn")),1)]),_:1},8,["class","disabled"])])])):h("",!0)])])}}};export{ie as default};
