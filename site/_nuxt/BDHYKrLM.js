import{c as L}from"./C7TzAs_Y.js";import{b as y,i as A}from"./BMShvsNX.js";import{P as x}from"./DyiL-6dj.js";import{W as _,n as v,o as c,h as p,w as u,a6 as m,e as n,M as b,s as S,q as z,ac as R,D as I,a5 as U,p as E,x as O,y as P,v as k,a7 as q,_ as F,d as g,f as $,t as j}from"./BqKV1jHe.js";import{c as M}from"./CDN07tui.js";import{r as N}from"./DM7nVvhd.js";import{_ as D}from"./qdLMPJJp.js";const[B,T]=L("AvatarRoot");var W=_({__name:"AvatarRoot",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(e){return y(),T({imageLoadingStatus:v("idle")}),(a,r)=>(c(),p(n(x),{"as-child":a.asChild,as:a.as},{default:u(()=>[m(a.$slots,"default")]),_:3},8,["as-child","as"]))}}),V=W,G=_({__name:"AvatarFallback",props:{delayMs:{type:Number,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(e){const a=e,r=B();y();const s=v(a.delayMs===void 0);return b(o=>{if(a.delayMs&&A){const l=window.setTimeout(()=>{s.value=!0},a.delayMs);o(()=>{window.clearTimeout(l)})}}),(o,l)=>s.value&&n(r).imageLoadingStatus.value!=="loaded"?(c(),p(n(x),{key:0,"as-child":o.asChild,as:o.as},{default:u(()=>[m(o.$slots,"default")]),_:3},8,["as-child","as"])):S("v-if",!0)}}),H=G;function w(e,a){return e?a?(e.src!==a&&(e.src=a),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function J(e,{referrerPolicy:a,crossOrigin:r}={}){const s=v(!1),o=v(null),l=I(()=>s.value?(!o.value&&A&&(o.value=new window.Image),o.value):null),i=v(w(l.value,e.value)),f=d=>()=>{s.value&&(i.value=d)};return z(()=>{s.value=!0,b(d=>{const t=l.value;if(!t)return;i.value=w(t,e.value);const h=f("loaded"),C=f("error");t.addEventListener("load",h),t.addEventListener("error",C),a?.value&&(t.referrerPolicy=a.value),typeof r?.value=="string"&&(t.crossOrigin=r.value),d(()=>{t.removeEventListener("load",h),t.removeEventListener("error",C)})})}),R(()=>{s.value=!1}),i}var K=_({__name:"AvatarImage",props:{src:{type:String,required:!0},referrerPolicy:{type:null,required:!1},crossOrigin:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"img"}},emits:["loadingStatusChange"],setup(e,{emit:a}){const r=e,s=a,{src:o,referrerPolicy:l,crossOrigin:i}=U(r);y();const f=B(),d=J(o,{referrerPolicy:l,crossOrigin:i});return E(d,t=>{s("loadingStatusChange",t),t!=="idle"&&(f.imageLoadingStatus.value=t)},{immediate:!0}),(t,h)=>O((c(),p(n(x),{role:"img","as-child":t.asChild,as:t.as,src:n(o),referrerpolicy:n(l),crossorigin:n(i)},{default:u(()=>[m(t.$slots,"default")]),_:3},8,["as-child","as","src","referrerpolicy","crossorigin"])),[[P,n(d)==="loaded"]])}}),Q=K;const X=_({__name:"Avatar",props:{class:{}},setup(e){const a=e;return(r,s)=>(c(),p(n(V),{"data-slot":"avatar",class:k(n(M)("relative flex size-8 shrink-0 overflow-hidden rounded-full",a.class))},{default:u(()=>[m(r.$slots,"default")]),_:3},8,["class"]))}}),Y=_({__name:"AvatarFallback",props:{delayMs:{},asChild:{type:Boolean},as:{},class:{}},setup(e){const a=e,r=N(a,"class");return(s,o)=>(c(),p(n(H),q({"data-slot":"avatar-fallback"},n(r),{class:n(M)("bg-muted flex size-full items-center justify-center rounded-full",a.class)}),{default:u(()=>[m(s.$slots,"default")]),_:3},16,["class"]))}}),Z=_({__name:"AvatarImage",props:{src:{},referrerPolicy:{},crossOrigin:{},asChild:{type:Boolean},as:{}},setup(e){const a=e;return(r,s)=>(c(),p(n(Q),q({"data-slot":"avatar-image"},a,{class:"aspect-square size-full"}),{default:u(()=>[m(r.$slots,"default")]),_:3},16))}}),ee={name:"MyAvatar",props:{user:{type:[Object,String],default:()=>{}},size:{type:[Number,String],default:40},round:{type:Boolean,default:!0},hasBorder:{type:Boolean,default:!1},extraStyle:{type:[Object],default:()=>{}}},computed:{avatarUrl(){return this.user.smallAvatar||this.user.avatar},usernameAt(){let e=this.user.nickname?this.user.nickname.charAt(0).toUpperCase():"";return e||(e=this.user.username?this.user.username.charAt(0).toUpperCase():""),e},sizeClass(){return{20:"h-5 w-5",24:"h-6 w-6",30:"h-[30px] w-[30px]",35:"h-[35px] w-[35px]",40:"h-10 w-10",45:"h-[45px] w-[45px]",50:"h-[50px] w-[50px]",60:"h-[60px] w-[60px]",70:"h-[70px] w-[70px]",80:"h-20 w-20",100:"h-[100px] w-[100px]",150:"h-[150px] w-[150px]"}[this.size]},roundClass(){return this.round?"round":""},borderClass(){return this.hasBorder?"has-border":""}}};function ae(e,a,r,s,o,l){const i=Z,f=Y,d=X,t=D;return r.user?(c(),p(t,{key:0,target:"_blank",to:`/user/${r.user.id}`},{default:u(()=>[g(d,{class:k([[l.sizeClass,l.roundClass,l.borderClass],"mx-auto"])},{default:u(()=>[g(i,{src:l.avatarUrl,alt:r.user.nickname},null,8,["src","alt"]),g(f,null,{default:u(()=>[$(j(l.usernameAt),1)]),_:1})]),_:1},8,["class"])]),_:1},8,["to"])):S("",!0)}const ie=Object.assign(F(ee,[["render",ae]]),{__name:"MyAvatar"});export{ie as _};
