import{_ as ae,a as re,b as le,c as ce}from"./Myp_MH4T.js";import{_ as Q}from"./nHyB59Vm.js";import{_ as P}from"./HzVF1qNI.js";import{j as W,u as D,Q as de,o as t,c as m,b as n,d as r,Z as B,e,w as p,f as M,t as v,R as j,E as C,H as S,C as J,S as O,L as Y,_ as q,x as ue,$ as pe,J as E,n as h,s as d,i as Z,a as ge,k as me,q as _e,h as y,aI as U,D as V}from"./IMHBmAvM.js";import{u as X}from"./D5uZVZ9k.js";import{s as fe}from"./m7h4t4CV.js";import{_ as we}from"./DYGa34Qb.js";import{u as he}from"./DJY5Y4zn.js";import{L as N}from"./HOsNf0ge.js";import{M as F}from"./KbqHngor.js";import"./CWBW37gM.js";import"./BZY-t1L7.js";import"./DWG3xSCv.js";import"./CboA2NrW.js";import"./DmwfaKwn.js";import"./GHR_VWTl.js";import"./Dy4Z_VQo.js";import"./Cop6u61-.js";import"./B1wiTl2V.js";import"./mWIteSzr.js";import"./FUKBWQwh.js";import"./lfLn7L41.js";import"./DDHZDh0S.js";import"./iGIsgRmF.js";import"./Dd-PvC5E.js";import"./DVjKhMGR.js";import"./BFULNkRl.js";import"./CcFcSr0Z.js";const ve={class:"password-login max-w-[400px] mx-auto"},ye={class:"space-y-2"},be={class:"space-y-2"},Le={class:"text-center"},xe={class:"text-center"},$e={__name:"LoginPassword",setup(x){const _=W(),{t:w}=D(),o=de({username:"",password:"",redirect:_.query.redirect||"",captchaId:null,captchaCode:null,captchaProtocol:2}),f=async()=>{if(!o.username){S(w("user.signin.password.usernameRequired"));return}if(!o.password){S(w("user.signin.password.passwordRequired"));return}try{const s=await X();o.captchaId=s.captchaId,o.captchaCode=s.captchaCode;try{const l=J(),{user:b,redirect:L}=await l.signin(o);await O(),setTimeout(()=>{L?C(L):C(`/user/${b.id}`)},50)}catch(l){Y(l)}}catch{console.log("用户取消了验证码验证")}},i=async()=>{o.redirect?C(`/user/signup?redirect=${encodeURIComponent(o.redirect)}`):C("/user/signup")},u=async()=>{C("/user/password/forgot")};return(s,l)=>{const b=Q,L=P;return t(),m("div",ve,[n("form",{class:"space-y-6",onSubmit:j(f,["prevent"])},[n("div",ye,[r(b,{modelValue:e(o).username,"onUpdate:modelValue":l[0]||(l[0]=$=>e(o).username=$),type:"text",placeholder:s.$t("user.signin.password.usernamePlaceholder"),onKeyup:B(f,["enter"])},null,8,["modelValue","placeholder"])]),n("div",be,[r(b,{modelValue:e(o).password,"onUpdate:modelValue":l[1]||(l[1]=$=>e(o).password=$),type:"password",placeholder:s.$t("user.signin.password.passwordPlaceholder"),onKeyup:B(f,["enter"])},null,8,["modelValue","placeholder"])]),r(L,{type:"submit",class:"w-full"},{default:p(()=>[M(v(s.$t("user.signin.password.loginBtn")),1)]),_:1}),n("div",Le,[n("a",{type:"button",class:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",onClick:u},v(s.$t("user.signin.password.forgotPassword")),1)]),n("div",xe,[n("a",{type:"button",class:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",onClick:i},v(s.$t("user.signin.password.noAccount")),1)])],32)])}}},ke={class:"sms-login max-w-[400px] mx-auto"},Ce={class:"space-y-2"},Se={class:"phone-input-wrapper"},Ie=["placeholder"],Te={class:"space-y-2"},Ve={class:"code-input-wrapper"},Re={__name:"LoginSms",props:{state:{type:String,default:null}},setup(x){const{t:_}=D(),w=h(!1),o=h(""),f=h(""),i=h(""),u=h(0),s=W(),l=J(),b=x,L=async()=>{if(!(u.value>0)){if(!/^1[0-9]{10}$/.test(o.value)){S(_("user.signin.sms.phoneError"));return}try{const a=await X();try{f.value=await l.smsSend({captchaId:a.captchaId,captchaCode:a.captchaCode,phone:o.value}),$()}catch(c){S(c.message||c)}}catch(a){console.log(a)}}},$=()=>{u.value=60;const a=fe(function(){u.value<=0?clearInterval(a):u.value--},1e3)},k=async()=>{w.value=!1;try{if(!/^1[0-9]{10}$/.test(o.value)){S(_("user.signin.sms.phoneError"));return}if(!f.value||!i.value){S(_("user.signin.sms.smsCodeRequired"));return}const{user:a,redirect:c}=await l.smsLogin({smsId:f.value,smsCode:i.value,redirect:s.query.redirect||"/",state:b.state||""});c?C(c):C("/user/"+a.id)}catch(a){S(a.message||a)}finally{w.value=!1}};return(a,c)=>{const T=Q,R=P;return t(),m("div",ke,[n("form",{class:"space-y-6",onSubmit:j(k,["prevent"])},[n("div",Ce,[n("div",Se,[c[2]||(c[2]=n("span",{class:"phone-prefix"},"+86",-1)),ue(n("input",{"onUpdate:modelValue":c[0]||(c[0]=g=>E(o)?o.value=g:null),type:"text",placeholder:a.$t("user.signin.sms.phonePlaceholder"),class:"phone-input",onKeyup:B(k,["enter"])},null,40,Ie),[[pe,e(o)]])])]),n("div",Te,[n("div",Ve,[r(T,{modelValue:e(i),"onUpdate:modelValue":c[1]||(c[1]=g=>E(i)?i.value=g:null),type:"text",placeholder:a.$t("user.signin.sms.smsCodePlaceholder"),class:"code-input",onKeyup:B(k,["enter"])},null,8,["modelValue","placeholder"]),r(R,{type:"button",variant:"outline",disabled:e(u)>0,class:"send-code-btn",onClick:L},{default:p(()=>[M(v(e(u)>0?`${e(u)} s`:a.$t("user.signin.sms.getSmsCode")),1)]),_:1},8,["disabled"])])]),r(R,{type:"submit",class:"w-full",loading:e(w)},{default:p(()=>[M(v(a.$t("user.signin.sms.loginBtn")),1)]),_:1},8,["loading"])],32)])}}},Ue=q(Re,[["__scopeId","data-v-4e5166c6"]]),Be={class:"google-login"},Me={key:0,class:"mr-2 h-5 w-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Pe={key:1},We={key:2},qe={__name:"LoginGoogle",props:{bind:{type:Boolean,default:!1}},setup(x){const _=W(),w=x,o=h(!1),f=async()=>{o.value=!0;try{const i=await Z("/api/login/google_login_config",{params:{redirect:_.query.redirect||"/",bind:w.bind}});window.location.href=i.authUrl}catch(i){Y(i),o.value=!1}};return(i,u)=>{const s=P;return t(),m("div",Be,[r(s,{class:"w-full",variant:"outline",disabled:e(o),onClick:f},{default:p(()=>[e(o)?d("",!0):(t(),m("svg",Me,[...u[0]||(u[0]=[n("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"},null,-1),n("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"},null,-1),n("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"},null,-1),n("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"},null,-1)])])),e(o)?(t(),m("span",Pe,v(i.$t("user.signin.googleLoggingIn")),1)):(t(),m("span",We,v(i.$t("user.signin.googleLoginButton")),1))]),_:1},8,["disabled"])])}}},ze=q(qe,[["__scopeId","data-v-8d03bccc"]]),Ee={class:"weixin-login"},De={__name:"LoginWeixin",props:{bind:{type:Boolean,default:!1}},setup(x,{expose:_}){const w=W(),o=x;return _({initWeixinSdk:async()=>{const i=await Z("/api/login/wx_login_config",{params:{redirect:w.query.redirect||"/",bind:o.bind}});new window.WxLogin({self_redirect:!1,id:"login_container",appid:i.appid,scope:i.scope,redirect_uri:i.redirect_uri,state:i.state||""})}}),(i,u)=>(t(),m("div",Ee,[...u[0]||(u[0]=[n("div",{id:"login_container",class:"login_container"},null,-1)])]))}},Ae=q(De,[["__scopeId","data-v-bd5929c9"]]),Ge="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1769345251524'%20class='icon'%20viewBox='0%200%201025%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='6705'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200.1953125'%20height='200'%3e%3cpath%20d='M1024.16%20694.816c0-149.92-143.104-271.392-319.584-271.392-176.576%200-319.68%20121.504-319.68%20271.392S528%20966.208%20704.576%20966.208c55.456%200%20107.648-12.096%20153.184-33.248l125.984%2054.528-14.592-140.544c34.784-43.392%2055.04-95.808%2055.04-152.128zM596.832%20621.28c-25.152%200-45.472-20.352-45.472-45.472s20.32-45.472%2045.472-45.472c25.12%200%2045.44%2020.384%2045.44%2045.472s-20.384%2045.472-45.44%2045.472z%20m215.392%200c-25.056%200-45.44-20.352-45.44-45.472s20.384-45.472%2045.44-45.472c25.184%200%2045.536%2020.384%2045.536%2045.472s-20.352%2045.472-45.536%2045.472zM704.576%20387.488c49.376%200%2096.416%208.8%20139.264%2024.64%200.32-5.728%200.992-11.232%200.992-16.992%200-198.08-189.152-358.624-422.432-358.624C189.184%2036.512%200.032%20197.024%200.032%20395.136c0%2074.496%2026.816%20143.776%2072.704%20201.12L53.472%20781.92l166.432-72.096c41.216%2019.2%2086.784%2032.16%20134.88%2038.784-3.616-17.504-5.824-35.424-5.824-53.792%200.032-169.44%20159.552-307.296%20355.616-307.296z%20m-139.808-209.6c33.184%200%2060%2026.88%2060%2060%200%2033.184-26.816%2060.064-60%2060.064s-60.032-26.88-60.032-60.064c0-33.152%2026.88-60%2060.032-60zM280.032%20297.952c-33.184%200-60-26.88-60-60.064%200-33.152%2026.848-60%2060-60%2033.184%200%2060.032%2026.88%2060.032%2060s-26.88%2060.064-60.032%2060.064z'%20fill='%2351C332'%20p-id='6706'%3e%3c/path%3e%3c/svg%3e",He={class:"main"},Ke={class:"container"},Ne={class:"main-body no-bg"},Fe={key:0,class:"login-title"},Qe={key:2},je={key:3,class:"third-party-login"},Je={key:0,class:"third-party-hint"},Oe={class:"third-party-buttons"},Ye={key:0,class:"third-party-button-wrapper"},Ze={key:1,class:"third-party-button-wrapper weixin-login-wrapper"},Xe=["src"],es={key:0,class:"weixin-qr-container"},ss={__name:"index",setup(x){const{t:_}=D();ge({title:he(_("user.signin.title"))});const w=h(null),o=h(null),f=h(null),i=h(null),s=me().config.loginConfig,l=V(()=>s.passwordLogin?.enabled||s.smsLogin?.enabled),b=V(()=>(s.passwordLogin?.enabled?1:0)+(s.smsLogin?.enabled?1:0)===1),L=V(()=>s.passwordLogin?.enabled?_("user.signin.passwordLogin"):s.smsLogin?.enabled?_("user.signin.smsLogin"):""),$=V(()=>s.googleLogin?.enabled||s.weixinLogin?.enabled),k=V(()=>s.passwordLogin?.enabled?"password":s.smsLogin?.enabled?"sms":"password"),a=h(k.value),c=h(!1),T=g=>{a.value=g},R=()=>{const g=!c.value;c.value=g,g&&O(()=>{o.value&&o.value.initWeixinSdk()})};return _e(()=>{l.value&&T(k.value)}),(g,I)=>{const A=le,ee=re,G=$e,H=ce,K=Ue,se=ae,oe=ze,ne=P,te=Ae,ie=we;return t(),m("section",He,[n("div",Ke,[n("div",Ne,[r(ie,{class:"max-w-[600px] mx-auto p-6"},{default:p(()=>[e(l)&&e(b)?(t(),m("div",Fe,[e(s).passwordLogin?.enabled?(t(),y(e(N),{key:0,class:"login-title-icon"})):e(s).smsLogin?.enabled?(t(),y(e(F),{key:1,class:"login-title-icon"})):d("",!0),n("h2",null,v(e(L)),1)])):d("",!0),e(l)&&!e(b)?(t(),y(se,{key:1,modelValue:e(a),"onUpdate:modelValue":I[2]||(I[2]=z=>E(a)?a.value=z:null),"default-value":e(k)},{default:p(()=>[r(ee,{class:"mx-auto login-tabs-list"},{default:p(()=>[e(s).passwordLogin?.enabled?(t(),y(A,{key:0,value:"password",class:"login-tab-trigger",onClick:I[0]||(I[0]=z=>T("password"))},{default:p(()=>[r(e(N),{class:"login-tab-icon"}),n("span",null,v(g.$t("user.signin.passwordLogin")),1)]),_:1})):d("",!0),e(s).smsLogin?.enabled?(t(),y(A,{key:1,value:"sms",class:"login-tab-trigger",onClick:I[1]||(I[1]=z=>T("sms"))},{default:p(()=>[r(e(F),{class:"login-tab-icon"}),n("span",null,v(g.$t("user.signin.smsLogin")),1)]),_:1})):d("",!0)]),_:1}),e(s).passwordLogin?.enabled?(t(),y(H,{key:0,value:"password"},{default:p(()=>[r(U,{name:"fade",mode:"out-in"},{default:p(()=>[e(a)==="password"?(t(),y(G,{ref_key:"passwordLoginRef",ref:i,key:"password"},null,512)):d("",!0)]),_:1})]),_:1})):d("",!0),e(s).smsLogin?.enabled?(t(),y(H,{key:1,value:"sms"},{default:p(()=>[r(U,{name:"fade",mode:"out-in"},{default:p(()=>[e(a)==="sms"?(t(),y(K,{ref_key:"smsLoginRef",ref:f,key:"sms"},null,512)):d("",!0)]),_:1})]),_:1})):d("",!0)]),_:1},8,["modelValue","default-value"])):d("",!0),e(l)&&e(b)?(t(),m("div",Qe,[r(U,{name:"fade",mode:"out-in"},{default:p(()=>[e(s).passwordLogin?.enabled?(t(),y(G,{ref_key:"passwordLoginRef",ref:i,key:"password"},null,512)):e(s).smsLogin?.enabled?(t(),y(K,{ref_key:"smsLoginRef",ref:f,key:"sms"},null,512)):d("",!0)]),_:1})])):d("",!0),e($)?(t(),m("div",je,[e(l)?(t(),m("div",Je,[n("span",null,v(g.$t("user.signin.thirdPartyLogin")),1)])):d("",!0),n("div",Oe,[e(s).googleLogin?.enabled?(t(),m("div",Ye,[r(oe,{ref_key:"googleLoginRef",ref:w},null,512)])):d("",!0),e(s).weixinLogin?.enabled?(t(),m("div",Ze,[r(ne,{variant:"outline",class:"weixin-trigger-btn",onClick:R},{default:p(()=>[n("img",{src:e(Ge),alt:"WeChat",class:"mr-2 h-4 w-4 weixin-icon"},null,8,Xe),M(" "+v(e(c)?g.$t("user.signin.hideWeixinQR"):g.$t("user.signin.weixinLogin")),1)]),_:1})])):d("",!0)]),r(U,{name:"slide-down"},{default:p(()=>[e(c)&&e(s).weixinLogin?.enabled?(t(),m("div",es,[r(te,{ref_key:"weixinLoginRef",ref:o},null,512)])):d("",!0)]),_:1})])):d("",!0)]),_:1})])])])}}},Vs=q(ss,[["__scopeId","data-v-2e13920c"]]);export{Vs as default};
