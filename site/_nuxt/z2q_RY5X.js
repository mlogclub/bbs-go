import{_ as H,a as $,R as N,b as S}from"./CvCms__v.js";import{_ as D}from"./nHyB59Vm.js";import{_ as P,a as R}from"./DvwhjJE8.js";import{_ as z}from"./HzVF1qNI.js";import{u as F}from"./Iih9WEmM.js";import{u as L,a as j,j as A,k as G,g,a3 as K,o as l,c as p,b as s,e as t,t as v,d,h,s as V,w as Q,f as q,v as J,K as k,D as O,z as W,G as X,E as Y,H as Z,n as tt}from"./IMHBmAvM.js";import{u as et}from"./DJY5Y4zn.js";import{u as ot}from"./BCbtPZa4.js";import"./BHeC9MU0.js";import"./CWBW37gM.js";import"./DVjKhMGR.js";import"./DWG3xSCv.js";import"./CboA2NrW.js";import"./DmwfaKwn.js";import"./BFULNkRl.js";import"./B1wiTl2V.js";import"./Dy4Z_VQo.js";import"./CcFcSr0Z.js";import"./FUKBWQwh.js";import"./DDHZDh0S.js";import"./-N5s2Nzn.js";import"./4YIWWuwH.js";import"./BZY-t1L7.js";import"./Dv21RA73.js";import"./C6aEUuvP.js";import"./Cop6u61-.js";import"./DkgBUR2o.js";import"./BOEcqi2e.js";import"./65VpZOqR.js";import"./DmPMBcKm.js";import"./Cyl0hmDu.js";import"./C6Y-ieo6.js";import"./CSh7zoJM.js";import"./mWIteSzr.js";import"./BOte5nSP.js";import"./dnDFdY6A.js";import"./iGIsgRmF.js";import"./Dd-PvC5E.js";const st={class:"main"},it={class:"container"},at={key:0,class:"publish-form"},nt={class:"form-title"},lt={class:"form-title-name"},dt={key:0,class:"editor-type"},rt={key:1,class:"editor-type"},mt={class:"field"},pt={class:"field"},ct={class:"control"},ut={class:"field"},_t={class:"control"},ft={key:0,class:"field"},gt={class:"control"},vt={class:"field"},ht={class:"control"},Vt={class:"form-footer"},ae={__name:"[id]",async setup(kt){let a,c;const{t:n,locale:u}=L();j({title:et(n("pages.topic.edit.pageTitle"))});const C=A(),w=G(),y=O(()=>w.config.enableHideContent),{data:T}=([a,c]=g(()=>k("/api/topic/nodes")),a=await a,c(),a),{data:e}=([a,c]=g(()=>k(`/api/topic/edit/${C.params.id}`)),a=await a,c(),a),r=tt(!1);let _=0;const U=()=>{ot(n("pages.topic.edit.switchEditorConfirm")).then(()=>{e.value.content="",e.value.contentType==="markdown"?e.value.contentType="html":e.value.contentType="markdown"}).catch(()=>{})};async function b(){const m=Date.now();if(!(m-_<500)&&(_=m,!r.value)){r.value=!0;try{await W(`/api/topic/edit/${e.value.id}`,{nodeId:e.value.nodeId,title:e.value.title,content:e.value.content,hideContent:e.value.hideContent,tags:e.value.tags||[]}),X({message:n("pages.topic.edit.success"),onClose(){Y(`/topic/${e.value.id}`)}})}catch(o){r.value=!1,Z(n("pages.topic.edit.failed",{msg:o.message||o}))}}}return(m,o)=>{const I=S,E=D,M=P,f=K("MEditor"),x=R,B=z;return l(),p("section",st,[s("div",it,[t(e)?(l(),p("div",at,[s("div",nt,[s("div",lt,v(t(n)("pages.topic.edit.title")),1),s("div",{class:"form-title-switch",onClick:U},[t(e).contentType==="markdown"?(l(),p("div",dt,[...o[6]||(o[6]=[s("img",{src:H},null,-1),s("span",null,"Markdown",-1)])])):(l(),p("div",rt,[...o[7]||(o[7]=[s("img",{src:$},null,-1),s("span",null,"HTML",-1)])])),d(t(N),{class:"h-4 w-4"})])]),s("div",mt,[d(I,{modelValue:t(e).nodeId,"onUpdate:modelValue":o[0]||(o[0]=i=>t(e).nodeId=i),nodes:t(T)||[]},null,8,["modelValue","nodes"])]),s("div",pt,[s("div",ct,[d(E,{modelValue:t(e).title,"onUpdate:modelValue":o[1]||(o[1]=i=>t(e).title=i),placeholder:t(n)("pages.topic.edit.titlePlaceholder")},null,8,["modelValue","placeholder"])])]),s("div",ut,[s("div",_t,[t(e).contentType==="markdown"?(l(),h(M,{key:0,modelValue:t(e).content,"onUpdate:modelValue":o[2]||(o[2]=i=>t(e).content=i),placeholder:t(n)("pages.topic.edit.contentPlaceholder")},null,8,["modelValue","placeholder"])):(l(),h(f,{key:1,modelValue:t(e).content,"onUpdate:modelValue":o[3]||(o[3]=i=>t(e).content=i),locale:t(u),"upload-image":"useUploadImage"in m?m.useUploadImage:t(F)},null,8,["modelValue","locale","upload-image"]))])]),t(y)||t(e).hideContent?(l(),p("div",ft,[s("div",gt,[d(f,{modelValue:t(e).hideContent,"onUpdate:modelValue":o[4]||(o[4]=i=>t(e).hideContent=i),locale:t(u),height:"200px"},null,8,["modelValue","locale"])])])):V("",!0),s("div",vt,[s("div",ht,[d(x,{modelValue:t(e).tags,"onUpdate:modelValue":o[5]||(o[5]=i=>t(e).tags=i)},null,8,["modelValue"])])]),s("div",Vt,[d(B,{class:J({"is-loading":t(r)}),disabled:t(r),onClick:b},{default:Q(()=>[q(v(t(n)("pages.topic.edit.submitBtn")),1)]),_:1},8,["class","disabled"])])])):V("",!0)])])}}};export{ae as default};
