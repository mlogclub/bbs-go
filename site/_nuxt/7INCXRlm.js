import{_ as O}from"./ChviGFow.js";import{_ as N,u as T,n as m,p as B,o as h,c as w,F as D,r as M,M as I,v as R,b as d,x as L,y as z,d as U,t as P,e as f,a6 as A,H as y,a2 as H}from"./Ck7AnVGd.js";import{u as W}from"./CZrVOCut.js";import{u as q}from"./Dj8WmZfa.js";import{T as G}from"./CNBhs_Fe.js";import{P as J}from"./By46hyff.js";const K={class:"image-uploads"},Q=["src"],X=["onClick"],Y=["accept"],Z={class:"add-image-btn-wrapper"},ee={__name:"ImageUpload",props:{modelValue:{type:Array,default(){return[]}},accept:{type:String,default:"image/*"},limit:{type:Number,default:9},sizeLimit:{type:Number,default:1024*1024*20},size:{type:String,default:"94px"}},emits:["update:modelValue"],setup(o,{expose:x,emit:S}){const{t:p}=T(),i=o,_=S,n=m(i.modelValue||[]),l=m([]),r=m(null),v=m(!1),g=m(!1);B(()=>i.modelValue,e=>{if(g.value){g.value=!1;return}n.value=Array.isArray(e)?[...e]:[],l.value=n.value.map(t=>({name:t.name||"unknown",url:t.url,progress:100,deleted:!1,size:t.size||0}))},{immediate:!0});const b=()=>{r.value&&r.value.dispatchEvent(new MouseEvent("click"))},V=e=>{const t=e.target.files;k(t)},k=e=>{if(!e||!e.length||!F(e)||!$(e))return;const t=[];for(let s=0;s<e.length;s++){const a=j(e[s]);l.value.push({name:e[s].name,url:a,progress:0,deleted:!1,size:e[s].size}),t.push(e[s])}C(t)},C=async e=>{v.value=!0;const t=l.value.length-e.length;try{for(let s=0;s<e.length;s++){const a=e[s],u=t+s;try{const c=await W(a);l.value[u].progress=100,n.value.push(c)}catch(c){console.error(`file ${a.name} upload failed:`,c),y(p("component.imageUpload.uploadFailed",{name:a.name,error:c.message||c})),l.value[u].deleted=!0,setTimeout(()=>{l.value.splice(u,1)},900)}}r.value&&(r.value.value=""),v.value=!1,g.value=!0,_("update:modelValue",n.value)}catch(s){y(s.message||s),r.value&&(r.value.value="");const a=e.length;l.value.splice(l.value.length-a,a),v.value=!1}},E=e=>{q(p("component.imageUpload.confirmDelete")).then(()=>{l.value[e].deleted=!0,n.value.splice(e,1),g.value=!0,_("update:modelValue",n.value),setTimeout(()=>{l.value.splice(e,1)},900)},()=>console.log("取消删除"))},F=e=>{let t=!0;for(let s=0;s<e.length;s++)e[s].size>i.sizeLimit&&(t=!1);return t||y(p("component.imageUpload.sizeLimitError",{size:i.sizeLimit/1024/1024})),t},$=e=>l.value.length+e.length>i.limit?(H(p("component.imageUpload.countLimitError",{limit:i.limit})),!1):!0,j=e=>{let t=null;return window.createObjectURL?t=window.createObjectURL(e):window.URL?t=window.URL.createObjectURL(e):window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t};return x({onClick:b,addFiles:k,clear:()=>{n.value=[],l.value=[]},loading:v}),(e,t)=>{const s=O;return h(),w("div",K,[(h(!0),w(D,null,M(f(l),(a,u)=>(h(),w("div",{key:u,class:R(["preview-item",{deleted:a.deleted}]),style:I({width:o.size,height:o.size})},[d("img",{src:a.url,class:"image-item"},null,8,Q),L(U(s,{"model-value":a.progress,class:"progress"},null,8,["model-value"]),[[z,a.progress<100]]),L(d("div",{class:"cover"},P(e.$t("component.imageUpload.uploading")),513),[[z,a.progress<100]]),d("div",{class:R(["upload-delete",{"show-delete":a.progress===100}]),onClick:c=>E(u)},[U(f(G),{class:"delete-icon h-[14px] w-[14px]"})],10,X)],6))),128)),L(d("div",{class:"add-image-btn",style:I({width:o.size,height:o.size}),onClick:t[0]||(t[0]=a=>b())},[d("input",{ref_key:"currentInput",ref:r,accept:o.accept,type:"file",multiple:"",onInput:V},null,40,Y),d("div",Z,[A(e.$slots,"add-image-button",{},()=>[U(f(J),{class:"add-icon h-[15px] w-[15px]"})],!0)])],4),[[z,f(l).length<o.limit]])])}}},ie=N(ee,[["__scopeId","data-v-4bffc6b8"]]);export{ie as _};
