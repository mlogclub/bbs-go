import{_ as ae,a as re,b as le,c as ce}from"./DCbhO86I.js";import{_ as Q}from"./BoRnC75M.js";import{_ as M}from"./jhzzEy-a.js";import{j as W,u as D,R as de,o,c as g,b as t,d as l,$ as U,e,w as u,f as B,t as y,S as j,E as S,H as k,C as J,T as O,L as Y,_ as q,x as ue,a0 as pe,J as E,n as h,s as d,i as X,a as ge,k as me,q as _e,h as v,aF as R,D as I}from"./B1RaE-U5.js";import{u as Z}from"./0h9YLVEE.js";import{s as fe}from"./Dtw53uHc.js";import{_ as we}from"./CfZHe973.js";import{u as he}from"./Bsv560Am.js";import{L as N}from"./CvAWajeB.js";import{M as F}from"./CFI7oY_Q.js";import"./TxH1ZWMw.js";import"./CDN07tui.js";import"./BUQ0YbzQ.js";import"./jAgMzLDF.js";import"./DO12yAhD.js";import"./DX9rx3_p.js";import"./B9DMEGyS.js";import"./DDZIm-qp.js";import"./CMyOL4G6.js";import"./DJu_MFF8.js";import"./FUKBWQwh.js";import"./5AePAui-.js";import"./CP219fWn.js";import"./B_DlFklR.js";import"./DUNcO_j-.js";import"./BAwY1kQT.js";import"./DMqoMF9r.js";import"./CcFcSr0Z.js";const ve={class:"password-login max-w-[400px] mx-auto"},ye={class:"space-y-2"},Le={class:"space-y-2"},be={class:"text-center"},xe={__name:"LoginPassword",setup(b){const m=W(),{t:w}=D(),n=de({username:"",password:"",redirect:m.query.redirect||"",captchaId:null,captchaCode:null,captchaProtocol:2}),_=async()=>{if(!n.username){k(w("user.signin.password.usernameRequired"));return}if(!n.password){k(w("user.signin.password.passwordRequired"));return}try{const a=await Z();n.captchaId=a.captchaId,n.captchaCode=a.captchaCode;try{const s=J(),{user:f,redirect:L}=await s.signin(n);await O(),setTimeout(()=>{L?S(L):S(`/user/${f.id}`)},50)}catch(s){Y(s)}}catch{console.log("用户取消了验证码验证")}},i=async()=>{n.redirect?S(`/user/signup?redirect=${encodeURIComponent(n.redirect)}`):S("/user/signup")};return(a,s)=>{const f=Q,L=M;return o(),g("div",ve,[t("form",{class:"space-y-6",onSubmit:j(_,["prevent"])},[t("div",ye,[l(f,{modelValue:e(n).username,"onUpdate:modelValue":s[0]||(s[0]=x=>e(n).username=x),type:"text",placeholder:a.$t("user.signin.password.usernamePlaceholder"),onKeyup:U(_,["enter"])},null,8,["modelValue","placeholder"])]),t("div",Le,[l(f,{modelValue:e(n).password,"onUpdate:modelValue":s[1]||(s[1]=x=>e(n).password=x),type:"password",placeholder:a.$t("user.signin.password.passwordPlaceholder"),onKeyup:U(_,["enter"])},null,8,["modelValue","placeholder"])]),l(L,{type:"submit",class:"w-full"},{default:u(()=>[B(y(a.$t("user.signin.password.loginBtn")),1)]),_:1}),t("div",be,[t("a",{type:"button",class:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",onClick:i},y(a.$t("user.signin.password.noAccount")),1)])],32)])}}},$e={class:"sms-login max-w-[400px] mx-auto"},ke={class:"space-y-2"},Ce={class:"phone-input-wrapper"},Se=["placeholder"],Te={class:"space-y-2"},Ie={class:"code-input-wrapper"},Ve={__name:"LoginSms",props:{state:{type:String,default:null}},setup(b){const{t:m}=D(),w=h(!1),n=h(""),_=h(""),i=h(""),a=h(0),s=W(),f=J(),L=b,x=async()=>{if(!(a.value>0)){if(!/^1[0-9]{10}$/.test(n.value)){k(m("user.signin.sms.phoneError"));return}try{const r=await Z();try{_.value=await f.smsSend({captchaId:r.captchaId,captchaCode:r.captchaCode,phone:n.value}),z()}catch(c){k(c.message||c)}}catch(r){console.log(r)}}},z=()=>{a.value=60;const r=fe(function(){a.value<=0?clearInterval(r):a.value--},1e3)},$=async()=>{w.value=!1;try{if(!/^1[0-9]{10}$/.test(n.value)){k(m("user.signin.sms.phoneError"));return}if(!_.value||!i.value){k(m("user.signin.sms.smsCodeRequired"));return}const{user:r,redirect:c}=await f.smsLogin({smsId:_.value,smsCode:i.value,redirect:s.query.redirect||"/",state:L.state||""});c?S(c):S("/user/"+r.id)}catch(r){k(r.message||r)}finally{w.value=!1}};return(r,c)=>{const T=Q,V=M;return o(),g("div",$e,[t("form",{class:"space-y-6",onSubmit:j($,["prevent"])},[t("div",ke,[t("div",Ce,[c[2]||(c[2]=t("span",{class:"phone-prefix"},"+86",-1)),ue(t("input",{"onUpdate:modelValue":c[0]||(c[0]=p=>E(n)?n.value=p:null),type:"text",placeholder:r.$t("user.signin.sms.phonePlaceholder"),class:"phone-input",onKeyup:U($,["enter"])},null,40,Se),[[pe,e(n)]])])]),t("div",Te,[t("div",Ie,[l(T,{modelValue:e(i),"onUpdate:modelValue":c[1]||(c[1]=p=>E(i)?i.value=p:null),type:"text",placeholder:r.$t("user.signin.sms.smsCodePlaceholder"),class:"code-input",onKeyup:U($,["enter"])},null,8,["modelValue","placeholder"]),l(V,{type:"button",variant:"outline",disabled:e(a)>0,class:"send-code-btn",onClick:x},{default:u(()=>[B(y(e(a)>0?`${e(a)} s`:r.$t("user.signin.sms.getSmsCode")),1)]),_:1},8,["disabled"])])]),l(V,{type:"submit",class:"w-full",loading:e(w)},{default:u(()=>[B(y(r.$t("user.signin.sms.loginBtn")),1)]),_:1},8,["loading"])],32)])}}},Re=q(Ve,[["__scopeId","data-v-4e5166c6"]]),Ue={class:"google-login"},Be={key:0,class:"mr-2 h-5 w-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Me={key:1},We={key:2},qe={__name:"LoginGoogle",props:{bind:{type:Boolean,default:!1}},setup(b){const m=W(),w=b,n=h(!1),_=async()=>{n.value=!0;try{const i=await X("/api/login/google_login_config",{params:{redirect:m.query.redirect||"/",bind:w.bind}});window.location.href=i.authUrl}catch(i){Y(i),n.value=!1}};return(i,a)=>{const s=M;return o(),g("div",Ue,[l(s,{class:"w-full",variant:"outline",disabled:e(n),onClick:_},{default:u(()=>[e(n)?d("",!0):(o(),g("svg",Be,[...a[0]||(a[0]=[t("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"},null,-1),t("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"},null,-1),t("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"},null,-1),t("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"},null,-1)])])),e(n)?(o(),g("span",Me,y(i.$t("user.signin.googleLoggingIn")),1)):(o(),g("span",We,y(i.$t("user.signin.googleLoginButton")),1))]),_:1},8,["disabled"])])}}},ze=q(qe,[["__scopeId","data-v-8d03bccc"]]),Pe={class:"weixin-login"},Ee={__name:"LoginWeixin",props:{bind:{type:Boolean,default:!1}},setup(b,{expose:m}){const w=W(),n=b;return m({initWeixinSdk:async()=>{const i=await X("/api/login/wx_login_config",{params:{redirect:w.query.redirect||"/",bind:n.bind}});new window.WxLogin({self_redirect:!1,id:"login_container",appid:i.appid,scope:i.scope,redirect_uri:i.redirect_uri,state:i.state||""})}}),(i,a)=>(o(),g("div",Pe,[...a[0]||(a[0]=[t("div",{id:"login_container",class:"login_container"},null,-1)])]))}},De=q(Ee,[["__scopeId","data-v-bd5929c9"]]),Ae="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1769345251524'%20class='icon'%20viewBox='0%200%201025%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='6705'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200.1953125'%20height='200'%3e%3cpath%20d='M1024.16%20694.816c0-149.92-143.104-271.392-319.584-271.392-176.576%200-319.68%20121.504-319.68%20271.392S528%20966.208%20704.576%20966.208c55.456%200%20107.648-12.096%20153.184-33.248l125.984%2054.528-14.592-140.544c34.784-43.392%2055.04-95.808%2055.04-152.128zM596.832%20621.28c-25.152%200-45.472-20.352-45.472-45.472s20.32-45.472%2045.472-45.472c25.12%200%2045.44%2020.384%2045.44%2045.472s-20.384%2045.472-45.44%2045.472z%20m215.392%200c-25.056%200-45.44-20.352-45.44-45.472s20.384-45.472%2045.44-45.472c25.184%200%2045.536%2020.384%2045.536%2045.472s-20.352%2045.472-45.536%2045.472zM704.576%20387.488c49.376%200%2096.416%208.8%20139.264%2024.64%200.32-5.728%200.992-11.232%200.992-16.992%200-198.08-189.152-358.624-422.432-358.624C189.184%2036.512%200.032%20197.024%200.032%20395.136c0%2074.496%2026.816%20143.776%2072.704%20201.12L53.472%20781.92l166.432-72.096c41.216%2019.2%2086.784%2032.16%20134.88%2038.784-3.616-17.504-5.824-35.424-5.824-53.792%200.032-169.44%20159.552-307.296%20355.616-307.296z%20m-139.808-209.6c33.184%200%2060%2026.88%2060%2060%200%2033.184-26.816%2060.064-60%2060.064s-60.032-26.88-60.032-60.064c0-33.152%2026.88-60%2060.032-60zM280.032%20297.952c-33.184%200-60-26.88-60-60.064%200-33.152%2026.848-60%2060-60%2033.184%200%2060.032%2026.88%2060.032%2060s-26.88%2060.064-60.032%2060.064z'%20fill='%2351C332'%20p-id='6706'%3e%3c/path%3e%3c/svg%3e",Ge={class:"main"},He={class:"container"},Ke={class:"main-body no-bg"},Ne={key:0,class:"login-title"},Fe={key:2},Qe={key:3,class:"third-party-login"},je={key:0,class:"third-party-hint"},Je={class:"third-party-buttons"},Oe={key:0,class:"third-party-button-wrapper"},Ye={key:1,class:"third-party-button-wrapper weixin-login-wrapper"},Xe=["src"],Ze={key:0,class:"weixin-qr-container"},es={__name:"index",setup(b){const{t:m}=D();ge({title:he(m("user.signin.title"))});const w=h(null),n=h(null),_=h(null),i=h(null),s=me().config.loginConfig,f=I(()=>s.passwordLogin?.enabled||s.smsLogin?.enabled),L=I(()=>(s.passwordLogin?.enabled?1:0)+(s.smsLogin?.enabled?1:0)===1),x=I(()=>s.passwordLogin?.enabled?m("user.signin.passwordLogin"):s.smsLogin?.enabled?m("user.signin.smsLogin"):""),z=I(()=>s.googleLogin?.enabled||s.weixinLogin?.enabled),$=I(()=>s.passwordLogin?.enabled?"password":s.smsLogin?.enabled?"sms":"password"),r=h($.value),c=h(!1),T=p=>{r.value=p},V=()=>{const p=!c.value;c.value=p,p&&O(()=>{n.value&&n.value.initWeixinSdk()})};return _e(()=>{f.value&&T($.value)}),(p,C)=>{const A=le,ee=re,G=xe,H=ce,K=Re,se=ae,ne=ze,oe=M,te=De,ie=we;return o(),g("section",Ge,[t("div",He,[t("div",Ke,[l(ie,{class:"max-w-[600px] mx-auto p-6"},{default:u(()=>[e(f)&&e(L)?(o(),g("div",Ne,[e(s).passwordLogin?.enabled?(o(),v(e(N),{key:0,class:"login-title-icon"})):e(s).smsLogin?.enabled?(o(),v(e(F),{key:1,class:"login-title-icon"})):d("",!0),t("h2",null,y(e(x)),1)])):d("",!0),e(f)&&!e(L)?(o(),v(se,{key:1,modelValue:e(r),"onUpdate:modelValue":C[2]||(C[2]=P=>E(r)?r.value=P:null),"default-value":e($)},{default:u(()=>[l(ee,{class:"mx-auto login-tabs-list"},{default:u(()=>[e(s).passwordLogin?.enabled?(o(),v(A,{key:0,value:"password",class:"login-tab-trigger",onClick:C[0]||(C[0]=P=>T("password"))},{default:u(()=>[l(e(N),{class:"login-tab-icon"}),t("span",null,y(p.$t("user.signin.passwordLogin")),1)]),_:1})):d("",!0),e(s).smsLogin?.enabled?(o(),v(A,{key:1,value:"sms",class:"login-tab-trigger",onClick:C[1]||(C[1]=P=>T("sms"))},{default:u(()=>[l(e(F),{class:"login-tab-icon"}),t("span",null,y(p.$t("user.signin.smsLogin")),1)]),_:1})):d("",!0)]),_:1}),e(s).passwordLogin?.enabled?(o(),v(H,{key:0,value:"password"},{default:u(()=>[l(R,{name:"fade",mode:"out-in"},{default:u(()=>[e(r)==="password"?(o(),v(G,{ref_key:"passwordLoginRef",ref:i,key:"password"},null,512)):d("",!0)]),_:1})]),_:1})):d("",!0),e(s).smsLogin?.enabled?(o(),v(H,{key:1,value:"sms"},{default:u(()=>[l(R,{name:"fade",mode:"out-in"},{default:u(()=>[e(r)==="sms"?(o(),v(K,{ref_key:"smsLoginRef",ref:_,key:"sms"},null,512)):d("",!0)]),_:1})]),_:1})):d("",!0)]),_:1},8,["modelValue","default-value"])):d("",!0),e(f)&&e(L)?(o(),g("div",Fe,[l(R,{name:"fade",mode:"out-in"},{default:u(()=>[e(s).passwordLogin?.enabled?(o(),v(G,{ref_key:"passwordLoginRef",ref:i,key:"password"},null,512)):e(s).smsLogin?.enabled?(o(),v(K,{ref_key:"smsLoginRef",ref:_,key:"sms"},null,512)):d("",!0)]),_:1})])):d("",!0),e(z)?(o(),g("div",Qe,[e(f)?(o(),g("div",je,[t("span",null,y(p.$t("user.signin.thirdPartyLogin")),1)])):d("",!0),t("div",Je,[e(s).googleLogin?.enabled?(o(),g("div",Oe,[l(ne,{ref_key:"googleLoginRef",ref:w},null,512)])):d("",!0),e(s).weixinLogin?.enabled?(o(),g("div",Ye,[l(oe,{variant:"outline",class:"weixin-trigger-btn",onClick:V},{default:u(()=>[t("img",{src:e(Ae),alt:"WeChat",class:"mr-2 h-4 w-4 weixin-icon"},null,8,Xe),B(" "+y(e(c)?p.$t("user.signin.hideWeixinQR"):p.$t("user.signin.weixinLogin")),1)]),_:1})])):d("",!0)]),l(R,{name:"slide-down"},{default:u(()=>[e(c)&&e(s).weixinLogin?.enabled?(o(),g("div",Ze,[l(te,{ref_key:"weixinLoginRef",ref:n},null,512)])):d("",!0)]),_:1})])):d("",!0)]),_:1})])])])}}},Is=q(es,[["__scopeId","data-v-2e13920c"]]);export{Is as default};
